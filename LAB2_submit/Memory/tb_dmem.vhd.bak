library ieee;
use ieee.std_logic_1164.all;
use ieee.numeric_std.all;

entity tb_dmem is
end tb_dmem;

architecture sim of tb_dmem is
    constant T : time := 10 ns;

    signal clk   : std_logic := '0';
    signal addr  : std_logic_vector(10 downto 0) := (others => '0');
    signal data  : std_logic_vector(31 downto 0) := (others => '0');
    signal we    : std_logic := '0';
    signal q     : std_logic_vector(31 downto 0);

begin
    -- Instantiate memory
    dmem : entity work.mem
        port map (
            clk  => clk,
            addr => addr,
            data => data,
            we   => we,
            q    => q
        );

    -- Clock
    clk <= not clk after T/2;

    stim_proc : process
    begin
        -- 1. Read first 10 values from 0x000..0x009
        
        for i in 0 to 9 loop
            addr <= std_logic_vector(to_unsigned(i, addr'length));
            we   <= '0';
            wait for T;
        end loop;

        -- 2. Write those values into 0x100..0x109
       
        for i in 0 to 9 loop
            addr <= std_logic_vector(to_unsigned(i+16#100#, addr'length));
            data <= q;       -- take whatever we read before
            we   <= '1';
            wait for T;
            we   <= '0';
            wait for T;
        end loop;

        -- 3. Read back from 0x100..0x109
     
        for i in 0 to 9 loop
            addr <= std_logic_vector(to_unsigned(i+16#100#, addr'length));
            we   <= '0';
            wait for T;
        end loop;

        wait;
    end process;
end sim;

